<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://www.ericlife.top').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: true,
    lazyload: true,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="记录开发过程中技术点">
<meta property="og:type" content="website">
<meta property="og:title" content="时光书馆">
<meta property="og:url" content="https://www.ericlife.top/page/3/index.html">
<meta property="og:site_name" content="时光书馆">
<meta property="og:description" content="记录开发过程中技术点">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Eric">
<meta property="article:tag" content="iOS开发 Eric 时光书馆 ios iOS 客户端 Xcode xcode osx phone iPhone iphone">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.ericlife.top/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>时光书馆</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="时光书馆" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">时光书馆</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">将来的自己,会感谢现在努力的自己!</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS%E5%BC%80%E5%8F%91%E8%AF%81%E4%B9%A6%E8%A6%81%E7%82%B9%E8%AF%A6%E8%A7%A3%EF%BC%8Cios%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS%E5%BC%80%E5%8F%91%E8%AF%81%E4%B9%A6%E8%A6%81%E7%82%B9%E8%AF%A6%E8%A7%A3%EF%BC%8Cios%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3.html" class="post-title-link" itemprop="url">iOS开发证书要点详解，ios证书详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-18 18:14:10" itemprop="dateCreated datePublished" datetime="2017-05-18T18:14:10+08:00">2017-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          可以作为了解，现在都是自动管理证书了。
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/iOS%E5%BC%80%E5%8F%91%E8%AF%81%E4%B9%A6%E8%A6%81%E7%82%B9%E8%AF%A6%E8%A7%A3%EF%BC%8Cios%E8%AF%81%E4%B9%A6%E8%AF%A6%E8%A7%A3.html">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS-%E6%96%87%E5%AD%97%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS-%E6%96%87%E5%AD%97%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93.html" class="post-title-link" itemprop="url">iOS-文字样式处理总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-10 11:56:05" itemprop="dateCreated datePublished" datetime="2017-05-10T11:56:05+08:00">2017-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在iOS开发中，常常会有一段文字显示不同的颜色和字体，或者给某几个文字加删除线或下划线的需求。NSMuttableAttstring（带属性的字符串），可以灵活实现以上功能。 NSMutableParagraphStyle段落风格，设置行间距、段间距、缩进、对齐方式等。</p>
<h2 id="1-实例化方法和使用方法"><a href="#1-实例化方法和使用方法" class="headerlink" title="1. 实例化方法和使用方法"></a>1. 实例化方法和使用方法</h2><p>实例化方法：<br>使用字符串初始化</p>
<ul>
<li>(id)initWithString:(NSString *)str;//例：NSMutableAttributedString *AttributedStr = [[NSMutableAttributedStringalloc]initWithString:@”文字样式处理”];</li>
</ul>
<p>字典中存放一些属性名和属性值：</p>
<ul>
<li>(id)initWithString:(NSString *)str attributes:(NSDictionary *)attrs;//如:NSDictionary *attributeDict = [NSDictionarydictionaryWithObjectsAndKeys: [UIFontsystemFontOfSize:15.0],NSFontAttributeName, [UIColorredColor],NSForegroundColorAttributeName, NSUnderlineStyleAttributeName,NSUnderlineStyleSingle,nil];NSMutableAttributedString *AttributedStr = [[NSMutableAttributedStringalloc]initWithString:@”文字样式处理” attributes:attributeDict];</li>
</ul>
<p>使用NSAttributedString初始化，跟NSMutableString，NSString类似:</p>
<ul>
<li>(id)initWithAttributedString:(NSAttributedString *)attester;</li>
</ul>
<p>使用方法：<br>为某一范围内文字设置多个属性</p>
<ul>
<li>(void)setAttributes:(NSDictionary *)attrs range:(NSRange)range;<br>为某一范围内文字添加某个属性</li>
<li>(void)addAttribute:(NSString *)name value:(id)value range:(NSRange)range;<br>为某一范围内文字添加多个属性</li>
<li>(void)addAttributes:(NSDictionary *)attrs range:(NSRange)range;<br>移除某范围内的某个属性</li>
<li>(void)removeAttribute:(NSString *)name range:(NSRange)range;</li>
</ul>
<h2 id="2-常见的属性及说明"><a href="#2-常见的属性及说明" class="headerlink" title="2. 常见的属性及说明"></a>2. 常见的属性及说明</h2><p><strong>NSFontAttributeName</strong> //字体<br><strong>NSParagraphStyleAttributeName</strong> //段落格式<br><strong>NSForegroundColorAttributeName</strong> //字体颜色<br><strong>NSBackgroundColorAttributeName</strong> //背景颜色<br><strong>NSStrikethroughStyleAttributeName</strong> //删除线格式<br><strong>NSUnderlineStyleAttributeName</strong> //下划线格式<br><strong>NSStrokeColorAttributeName</strong> //删除线颜色<br><strong>NSStrokeWidthAttributeName</strong>//删除线宽度<br><strong>NSShadowAttributeName</strong> //阴影<br><strong>NSParagraphStyleAttributeName</strong>//段落的风格（设置首行，行间距，对齐方式什么的）</p>
<p>NSMutableParagraphStyle <em>paragraphStyle = [[NSMutableParagraphStyle alloc] init];<br>paragraphStyle.lineSpacing = 10;// 字体的行间距 paragraphStyle.firstLineHeadIndent = 20.0f;//首行缩进 paragraphStyle.alignment = NSTextAlignmentJustified;//（两端对齐的）文本对齐方式：（左，中，右，两端对齐，自然）<br>paragraphStyle.lineBreakMode = NSLineBreakByTruncatingTail;//结尾部分的内容以……方式省略 ( “…wxyz” ,”abcd…” ,”ab…yz”)<br>paragraphStyle.headIndent = 20;//整体缩进(首行除外)<br>paragraphStyle.tailIndent = 20;//<br>paragraphStyle.minimumLineHeight = 10;//最低行高<br>paragraphStyle.maximumLineHeight = 20;//最大行高<br>paragraphStyle.paragraphSpacing = 15;//段与段之间的间距<br>paragraphStyle.paragraphSpacingBefore = 22.0f;//段首行空白空间/</em> Distance between the bottom of the previous paragraph (or the end of its paragraphSpacing, if any) and the top of this paragraph. <em>/<br>paragraphStyle.baseWritingDirection = NSWritingDirectionLeftToRight;//从左到右的书写方向（一共三种）<br>paragraphStyle.lineHeightMultiple = 15;//</em> Natural line height is multiplied by this factor (if positive) before being constrained by minimum and maximum line height. *//<br>paragraphStyle.hyphenationFactor = 1;//连字属性 在iOS，唯一支持的值分别为0和1</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">两个样式枚举</span><br><span class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSInteger</span>, <span class="type">NSLineBreakMode</span>) &#123;/* <span class="type">What</span> to do with long lines */ </span><br><span class="line"><span class="type">NSLineBreakByWordWrapping</span> = 0, /* <span class="type">Wrap</span> at word boundaries, default */</span><br><span class="line"> <span class="type">NSLineBreakByCharWrapping</span>,/* <span class="type">Wrap</span> at character boundaries */ </span><br><span class="line"><span class="type">NSLineBreakByClipping</span>,/* <span class="type">Simply</span> clip */剪掉后面显示不了的部分 </span><br><span class="line"><span class="type">NSLineBreakByTruncatingHead</span>,/* <span class="type">Truncate</span> at head of line: "...wxyz" */头部分的内容以……方式省略 </span><br><span class="line"><span class="type">NSLineBreakByTruncatingTail</span>,/* <span class="type">Truncate</span> at tail of line: "abcd..." */结尾部分的内容以……方式省略 </span><br><span class="line"><span class="type">NSLineBreakByTruncatingMiddle</span>/* <span class="type">Truncate</span> middle of line: "ab...yz" */中间部分的内容以……方式省略 </span><br><span class="line">&#125; <span class="type">NS_ENUM_AVAILABLE_IOS</span>(6_0); </span><br><span class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSInteger</span>, <span class="type">NSWritingDirection</span>) &#123; </span><br><span class="line"><span class="type">NSWritingDirectionNatural</span> = -1, // <span class="type">Determines</span> direction using the <span class="type">Unicode</span> <span class="type">Bidi</span> <span class="type">Algorithm</span> rules <span class="type">P2</span> and <span class="type">P3</span>  </span><br><span class="line"><span class="type">NSWritingDirectionLeftToRight</span> = 0, // <span class="type">Left</span> to right writing direction 左到右的书写方向  </span><br><span class="line"><span class="type">NSWritingDirectionRightToLeft</span> = 1 // <span class="type">Right</span> to left writing direction 右到左的书写方向 </span><br><span class="line">&#125; <span class="type">NS_ENUM_AVAILABLE_IOS</span>(6_0);</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* NSFontAttributeName 字体大小 </span></span><br><span class="line"><span class="comment">NSParagraphStyleAttributeName 段落的风格（设置首行，行间距，对齐方式什么的） </span></span><br><span class="line"><span class="comment">NSKernAttributeName 字间距 */</span></span><br><span class="line"> NSDictionary *attributes = @&#123; </span><br><span class="line"><span class="string">NSFontAttributeName:</span>[UIFont <span class="string">systemFontOfSize:</span><span class="number">15</span>], </span><br><span class="line"><span class="string">NSParagraphStyleAttributeName:</span>paragraphStyle, </span><br><span class="line"><span class="string">NSKernAttributeName:</span>@(<span class="number">10</span>), </span><br><span class="line">&#125;; </span><br><span class="line">textView.attributedText = [[NSAttributedString alloc] <span class="string">initWithString:</span>textView.text <span class="string">attributes:</span>attributes];</span><br></pre></td></tr></table></figure>

<p>再来个实例</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//随便定义一个字符串，做测试使用 </span></span><br><span class="line"><span class="built_in">NSString</span> *massageStr = <span class="string">@"\t北京乌托邦有限公司（以下简称“乌托邦”）在此特别提醒您（用户）在注册成为用户之前，请认真阅读本《用户协议》（以下简称“协议”），确保您充分理解本协议中各条款。请您审慎阅读并选择接受或不接受本协议。除非您接受本协议所有条款，否则您无权注册、登录或使用本协议所涉服务。您的注册、登录、使用等行为将视为对本协议的接受，并同意接受本协议各项条款的约束。\r\n \t本协议约定乌托邦与用户之间关于“乌托邦”软件服务（以下简称“服务”）的权利义务。“用户”是指注册、登录、使用本服务的个人。本协议可由乌托邦随时更新，更新后的协议条款一旦公布即代替原来的协议条款，恕不再另行通知，用户可在本网站查阅最新版协议条款。在乌托邦修改协议条款后，如果用户不接受修改后的条款，请立即停止使用乌托邦提供的服务，用户继续使用乌托邦提供的服务将被视为接受修改后的协议。"</span>; </span><br><span class="line"><span class="built_in">NSMutableAttributedString</span> *attributedString = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:massageStr]; </span><br><span class="line"><span class="built_in">NSMutableParagraphStyle</span> *paragraphStyle = [[<span class="built_in">NSMutableParagraphStyle</span> alloc] init];</span><br><span class="line">[paragraphStyle setLineSpacing:<span class="number">20</span>];</span><br><span class="line"><span class="comment">//调整行间距</span></span><br><span class="line">[attributedString addAttribute:<span class="built_in">NSParagraphStyleAttributeName</span> value:paragraphStyle range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [<span class="keyword">self</span>.agreementText length])];</span><br><span class="line">[attributedString addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:</span><br><span class="line">[<span class="built_in">UIColor</span> redColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">12</span>)]; <span class="comment">// 0为起始位置 length是从起始位置开始 设置指定颜色的长度 </span></span><br><span class="line">[attributedString addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">18</span>, <span class="number">3</span>)]; <span class="comment">//设置尺寸 </span></span><br><span class="line">[attributedString addAttribute:<span class="built_in">NSFontAttributeName</span> value:[<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">20</span>] range:<span class="built_in">NSMakeRange</span>(<span class="number">18</span>, <span class="number">3</span>)]; <span class="comment">// 0为起始位置 length是从起始位置开始 设置指定字体尺寸的长度</span></span><br></pre></td></tr></table></figure>

<p>根据字符串获取宽高<br>根据宽度求高度 content 计算的内容 width 计算的宽度 font字体大小</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGFloat</span>)getHeightWithContent:(<span class="built_in">NSString</span> *)content width:(<span class="built_in">CGFloat</span>)width font:(<span class="built_in">CGFloat</span>)font&#123; </span><br><span class="line"><span class="built_in">CGRect</span> rect = [content boundingRectWithSize:<span class="built_in">CGSizeMake</span>(width, <span class="number">999</span>) options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> attributes:@&#123;</span><br><span class="line"><span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:font]&#125;  context:<span class="literal">nil</span>]; </span><br><span class="line"><span class="keyword">return</span> rect.size.height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据高度度求宽度 content 计算的内容 Height 计算的高度 font字体大小</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGFloat</span>)getWidthWithContent:(<span class="built_in">NSString</span> *)content height:(<span class="built_in">CGFloat</span>)height font:(<span class="built_in">CGFloat</span>)font&#123; </span><br><span class="line"><span class="built_in">CGRect</span> rect = [content boundingRectWithSize:<span class="built_in">CGSizeMake</span>(<span class="number">999</span>, height) options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> attributes:@&#123;</span><br><span class="line"><span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:font]&#125; context:<span class="literal">nil</span>]; </span><br><span class="line"><span class="keyword">return</span> rect.size.width;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、更多属性"><a href="#3、更多属性" class="headerlink" title="3、更多属性"></a>3、更多属性</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">NSStrikethroughColorAttributeName 的时候，值也是这个枚举。</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlineStyleNone 不设置下划线／删除线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlineStyleSingle 设置下划线／删除线为细的单线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlineStyleThick 设置下划线／删除线为粗的单线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlineStyleDouble 设置下划线／删除线为细的双线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlinePatternSolid 设置下划线／删除线样式为连续的实线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlinePatternDot 设置下划线／删除线样式为点，也就是虚线，比如这样：－－－－－－</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlinePatterDash 设置下划线／删除线样式为破折号，比如这样：—— —— ——</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlinePatternDashDot 设置下划线／删除线样式为连续的破折号和点，比如这样：——－——－——－</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlinePatternDashDotDot 设置下划线／删除线样式为连续的破折号、点、点，比如：——－－——－－——－－</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSUnderlineByWord 在有空格的地方不设置下划线／删除线</span></span><br><span class="line">在设置以上属性时，可以以<span class="string">|分隔，同时设置多个属性</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS%E5%BC%80%E5%8F%91%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8BGCD.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS%E5%BC%80%E5%8F%91%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8BGCD.html" class="post-title-link" itemprop="url">iOS开发之多线程GCD</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-16 09:07:05" itemprop="dateCreated datePublished" datetime="2017-03-16T09:07:05+08:00">2017-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="目前多线程主要分为三类："><a href="#目前多线程主要分为三类：" class="headerlink" title="目前多线程主要分为三类："></a>目前多线程主要分为三类：</h4><p> 1 NSThread<br> 2 NSOperation<br> 3 GCD<br>前面两种网上资料很多，本文就苹果推荐使用的GCD理一理。</p>
<h2 id="一、多线程相关概念"><a href="#一、多线程相关概念" class="headerlink" title="一、多线程相关概念"></a>一、多线程相关概念</h2><p>进程与线程的关系？</p>
<ul>
<li>进程：app打开的时候会打开相应的进程，一般情况下，一个App会有一个或多个进程，但是iOS的App一般只有一个进程（后台播放，IM除外）。在iOS系统中，打开一个新的App会挂起其他App的进程。一个进程会包含一个或多个线程。</li>
<li>线程：一个线程同时只可以执行一个任务，多线程就可以同时执行多个任务。一个进程可以包含多个线程。</li>
</ul>
<p>主线程和子线程（非主线程）到底有什么区别？</p>
<ul>
<li>主线程：iOS程序中，主线程（又叫作UI线程）主要任务是处理UI事件，显示和刷新UI，（只有主线程有直接修改UI的能力）耗时的操作放在子线程（又叫作后台线程、异步线程）。</li>
<li>子线程：在iOS中开子线程去处理耗时的操作，可以有效提高程序的执行效率，提高资源利用率。</li>
</ul>
<p>但是开启线程会占用一定的内存，（主线程的堆栈大小是1M，第二个线程开始都是512KB，并且该值不能通过编译器开关或线程API函数来更改）降低程序的性能。所以一般不要同时开很多线程。</p>
<p>注:查看当前线程信息用<strong>[NSThread currentThread]</strong>，而不要用<strong>[NSOperationQueue currentQueue]</strong>，因前者内容可以看到更全面的线程信息！</p>
<p>下面进入正题：</p>
<h2 id="二、GCD几个重要的关键字"><a href="#二、GCD几个重要的关键字" class="headerlink" title="二、GCD几个重要的关键字"></a>二、GCD几个重要的关键字</h2><h3 id="2-1、异步与同步"><a href="#2-1、异步与同步" class="headerlink" title="2.1、异步与同步"></a>2.1、异步与同步</h3><ul>
<li>异步执行：具备开新线程的能力，可以先绕过线程任务，回头再执行。</li>
<li>同步执行：不具备开新线程的能力，因此只能在当前线程中执行！任务执行必须按顺序执行（必须执行完当前任务才会继续走代码）。</li>
</ul>
<h3 id="2-2、并发队列与串行队列"><a href="#2-2、并发队列与串行队列" class="headerlink" title="2.2、并发队列与串行队列"></a>2.2、并发队列与串行队列</h3><ul>
<li>并发队列：队列中的任务同时执行(Concurrent Dispatch Queue)</li>
<li>串行队列：队列中的任务按添加任务顺序执行(Serial Dispatch Queue)</li>
</ul>
<p>注：这里说的任务就是GCD中block中的代码。</p>
<p>这里的关键字一般都是组合用，理解单个是没有意义的，组合后的效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-dbeb080ec6b0f86c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="注：如果同步执行的时候，不放入新创建的线程中的话，就会在主线程执行。"></p>
<h3 id="2-3、同步的情况下需要注意"><a href="#2-3、同步的情况下需要注意" class="headerlink" title="2.3、同步的情况下需要注意"></a>2.3、同步的情况下需要注意</h3><p><strong>以下两种同步执行的情况都是在主线程执行的：</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"abcd"</span>, DISPATCH_QUEUE_CONCURRENT);<span class="comment">//并发队列</span></span><br><span class="line"><span class="comment">//这里的abcd仅仅作为调试时用的标识符，打印线程属性时并不是name</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">10</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">11</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">12</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(concurrentQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">13</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">54.797</span> 多线程GCD[<span class="number">80605</span>:<span class="number">13173361</span>] 执行：<span class="number">10</span> 线程信息：&lt;NSThread: <span class="number">0x600000073ec0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">57.342</span> 多线程GCD[<span class="number">80605</span>:<span class="number">13173361</span>] 执行：<span class="number">11</span> 线程信息：&lt;NSThread: <span class="number">0x600000073ec0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">59.681</span> 多线程GCD[<span class="number">80605</span>:<span class="number">13173361</span>] 执行：<span class="number">12</span> 线程信息：&lt;NSThread: <span class="number">0x600000073ec0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">39</span>:<span class="number">01.966</span> 多线程GCD[<span class="number">80605</span>:<span class="number">13173361</span>] 执行：<span class="number">13</span> 线程信息：&lt;NSThread: <span class="number">0x600000073ec0</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"aa"</span>, DISPATCH_QUEUE_SERIAL);<span class="comment">//串行队列</span></span><br><span class="line"><span class="comment">//这里的DISPATCH_QUEUE_SERIAL等价于NULL</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">5</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">6</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">7</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class="line">    [<span class="keyword">self</span> loadImage:@<span class="number">8</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">45</span>:<span class="number">30.928</span> 多线程GCD[<span class="number">81007</span>:<span class="number">13250389</span>] 执行：<span class="number">5</span> 线程信息：&lt;NSThread: <span class="number">0x600000065000</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">45</span>:<span class="number">37.232</span> 多线程GCD[<span class="number">81007</span>:<span class="number">13250389</span>] 执行：<span class="number">6</span> 线程信息：&lt;NSThread: <span class="number">0x600000065000</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">45</span>:<span class="number">39.713</span> 多线程GCD[<span class="number">81007</span>:<span class="number">13250389</span>] 执行：<span class="number">7</span> 线程信息：&lt;NSThread: <span class="number">0x600000065000</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">45</span>:<span class="number">42.314</span> 多线程GCD[<span class="number">81007</span>:<span class="number">13250389</span>] 执行：<span class="number">8</span> 线程信息：&lt;NSThread: <span class="number">0x600000065000</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br></pre></td></tr></table></figure>
<p><strong>正确的打开方式：</strong></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t serialQueue = dispatch_queue_create(<span class="string">"aa"</span>, DISPATCH_QUEUE_SERIAL)<span class="comment">;//串行队列</span></span><br><span class="line"></span><br><span class="line">dispatch_async(<span class="name">dispatch_queue_create</span>(<span class="string">"abcd"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    </span><br><span class="line">    dispatch_sync(<span class="name">serialQueue</span>, ^&#123;</span><br><span class="line">        [self loadImage:@<span class="number">5</span>]<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    dispatch_sync(<span class="name">serialQueue</span>, ^&#123;</span><br><span class="line">        [self loadImage:@<span class="number">6</span>]<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    dispatch_sync(<span class="name">serialQueue</span>, ^&#123;</span><br><span class="line">        [self loadImage:@<span class="number">7</span>]<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    dispatch_sync(<span class="name">serialQueue</span>, ^&#123;</span><br><span class="line">        [self loadImage:@<span class="number">8</span>]<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">47</span>:<span class="number">15.677</span> 多线程GCD[<span class="number">81128</span>:<span class="number">13270066</span>] 执行：<span class="number">5</span> 线程信息：&lt;NSThread: <span class="number">0x60800007e000</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">47</span>:<span class="number">18.103</span> 多线程GCD[<span class="number">81128</span>:<span class="number">13270066</span>] 执行：<span class="number">6</span> 线程信息：&lt;NSThread: <span class="number">0x60800007e000</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">47</span>:<span class="number">20.470</span> 多线程GCD[<span class="number">81128</span>:<span class="number">13270066</span>] 执行：<span class="number">7</span> 线程信息：&lt;NSThread: <span class="number">0x60800007e000</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">47</span>:<span class="number">22.774</span> 多线程GCD[<span class="number">81128</span>:<span class="number">13270066</span>] 执行：<span class="number">8</span> 线程信息：&lt;NSThread: <span class="number">0x60800007e000</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>
<p><strong>以上说的是同步的时候需要注意的，下面说一下异步的情况：</strong></p>
<h3 id="2-4、异步的情况下需要注意-1"><a href="#2-4、异步的情况下需要注意-1" class="headerlink" title="2.4、异步的情况下需要注意-1"></a>2.4、异步的情况下需要注意-1</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"aa"</span>, DISPATCH_QUEUE_SERIAL);<span class="comment">//串行队列</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">0</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">1</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">2</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">3</span>];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">49</span>:<span class="number">14.498</span> 多线程GCD[<span class="number">81251</span>:<span class="number">13288476</span>] 执行：<span class="number">0</span> 线程信息：&lt;NSThread: <span class="number">0x600000262680</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">49</span>:<span class="number">17.125</span> 多线程GCD[<span class="number">81251</span>:<span class="number">13288476</span>] 执行：<span class="number">1</span> 线程信息：&lt;NSThread: <span class="number">0x600000262680</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">49</span>:<span class="number">19.599</span> 多线程GCD[<span class="number">81251</span>:<span class="number">13288476</span>] 执行：<span class="number">2</span> 线程信息：&lt;NSThread: <span class="number">0x600000262680</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">49</span>:<span class="number">21.934</span> 多线程GCD[<span class="number">81251</span>:<span class="number">13288476</span>] 执行：<span class="number">3</span> 线程信息：&lt;NSThread: <span class="number">0x600000262680</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"abcd"</span>, DISPATCH_QUEUE_CONCURRENT);<span class="comment">//并发队列</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">0</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">1</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">2</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> loadImage:@<span class="number">3</span>];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">06.805</span> 多线程GCD[<span class="number">81549</span>:<span class="number">13342819</span>] 执行：<span class="number">1</span> 线程信息：&lt;NSThread: <span class="number">0x608000072f80</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">06.805</span> 多线程GCD[<span class="number">81549</span>:<span class="number">13341379</span>] 执行：<span class="number">0</span> 线程信息：&lt;NSThread: <span class="number">0x60800007b200</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">06.805</span> 多线程GCD[<span class="number">81549</span>:<span class="number">13342821</span>] 执行：<span class="number">3</span> 线程信息：&lt;NSThread: <span class="number">0x6080000743c0</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">06.805</span> 多线程GCD[<span class="number">81549</span>:<span class="number">13342820</span>] 执行：<span class="number">2</span> 线程信息：&lt;NSThread: <span class="number">0x60000026a400</span>&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>
<p>在串行队列异步执行过程中，会创建一个线程，按顺序执行当前线程中的任务。有阻塞！<br>在并发队列异步执行过程中，可能会创建多个线程，同时执行当前线程中的任务。没有阻塞！</p>
<h3 id="2-4、异步的情况下需要注意-2"><a href="#2-4、异步的情况下需要注意-2" class="headerlink" title="2.4、异步的情况下需要注意-2"></a>2.4、异步的情况下需要注意-2</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"aaa"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@0]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"bbb"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@1]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"ccc"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@2]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"ddd"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@3]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"eee"</span>, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@4]</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">10.966</span> 多线程GCD[<span class="number">82282</span>:<span class="number">13469275</span>] 执行：<span class="number">2</span> 线程信息：&lt;NSThread: <span class="number">0x608000076100</span>&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">10.966</span> 多线程GCD[<span class="number">82282</span>:<span class="number">13469905</span>] 执行：<span class="number">4</span> 线程信息：&lt;NSThread: <span class="number">0x6080000738c0</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">10.966</span> 多线程GCD[<span class="number">82282</span>:<span class="number">13469278</span>] 执行：<span class="number">3</span> 线程信息：&lt;NSThread: <span class="number">0x608000075b40</span>&gt;&#123;number = <span class="number">7</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">10.966</span> 多线程GCD[<span class="number">82282</span>:<span class="number">13469331</span>] 执行：<span class="number">1</span> 线程信息：&lt;NSThread: <span class="number">0x600000076d00</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">10.966</span> 多线程GCD[<span class="number">82282</span>:<span class="number">13469276</span>] 执行：<span class="number">0</span> 线程信息：&lt;NSThread: <span class="number">0x60800006dcc0</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>
<p>以上会创建5个串行队列线程，而不是1个串行队列线程，因为不是同一个线程，所以执行顺序是同时执行，互相没有影响(对于并发队列是同样的)。<br>正确使用方法应该是1中创建的方式，对于并发队列，计算机会根据性能和需要创建合理的线程数量。保证系统高性能和流畅性。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"a"</span>, DISPATCH_QUEUE_CONCURRENT), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@14]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"b"</span>, DISPATCH_QUEUE_CONCURRENT), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@15]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"c"</span>, DISPATCH_QUEUE_CONCURRENT), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@16]</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="selector-tag">dispatch_async</span>(dispatch_queue_create(<span class="string">"d"</span>, DISPATCH_QUEUE_CONCURRENT), ^&#123;</span><br><span class="line">    <span class="selector-attr">[self loadImage:@17]</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">03</span>:<span class="number">51.193</span> 多线程GCD[<span class="number">82177</span>:<span class="number">13453338</span>] 执行：<span class="number">15</span> 线程信息：&lt;NSThread: <span class="number">0x608000263040</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">03</span>:<span class="number">51.193</span> 多线程GCD[<span class="number">82177</span>:<span class="number">13449499</span>] 执行：<span class="number">14</span> 线程信息：&lt;NSThread: <span class="number">0x608000261580</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">03</span>:<span class="number">51.193</span> 多线程GCD[<span class="number">82177</span>:<span class="number">13453339</span>] 执行：<span class="number">16</span> 线程信息：&lt;NSThread: <span class="number">0x608000272f00</span>&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">03</span>:<span class="number">51.193</span> 多线程GCD[<span class="number">82177</span>:<span class="number">13453340</span>] 执行：<span class="number">17</span> 线程信息：&lt;NSThread: <span class="number">0x60000026e740</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-5、关键字-Main-Dispatch-Queue-Global-Dispatch-Queue"><a href="#2-5、关键字-Main-Dispatch-Queue-Global-Dispatch-Queue" class="headerlink" title="2.5、关键字 - Main Dispatch Queue/Global Dispatch Queue"></a>2.5、关键字 - Main Dispatch Queue/Global Dispatch Queue</h3><p>实际上不用特意生成Dispatch Queue，系统也会为我们准备几个。那就是Main Dispatch Queue和Global Dispatch Queue。</p>
<ul>
<li>Main Dispatch Queue就是主线程，因为主线程只有一个，所以Main Dispatch Queue是Serial Dispatch Queue。Main Dispatch Queue的处理在主线程的Runloop中执行。</li>
</ul>
<p>相应的，Global Dispatch Queue是系统为我们准备的Concurrent Dispatch Queue。Global Dispatch Queue有四个优先级，应根据需求使用对应优先级。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2647951-8b89934a89887dcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="优先级.png"></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  high优先级的获取方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">dispatch_queue_t </span>globalHighQueue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, </span><span class="number">0</span>);</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  default优先级的获取方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">dispatch_queue_t </span>globalDefaultQueue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, </span><span class="number">0</span>);</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  low优先级的获取方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">dispatch_queue_t </span>globalLowQueue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, </span><span class="number">0</span>);</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  background优先级的获取方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">dispatch_queue_t </span>globalBackgroundQueue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, </span><span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p><strong>更改队列优先级：dispatch_set_target_queue(dispatch_object_t  _Nonnull object, dispatch_queue_t  _Nullable queue)</strong></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t </span>serialQueue = <span class="keyword">dispatch_queue_create("aa", </span><span class="keyword">DISPATCH_QUEUE_SERIAL);//串行队列</span></span><br><span class="line"><span class="keyword"> </span>  </span><br><span class="line"><span class="keyword">dispatch_queue_t </span>globalBackgroundQueue = <span class="keyword">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, </span><span class="number">0</span>);</span><br><span class="line">   </span><br><span class="line"><span class="keyword">dispatch_set_target_queue(serialQueue, </span>globalBackgroundQueue)<span class="comment">;将serialQueue指定为globalBackgroundQueue用。</span></span><br></pre></td></tr></table></figure>
<p>注：如果这里用函数dispatch_set_target_queue将多个Serial Dispatch Queue指定为同一个Serial Dispatch Queue，就会将原本并发的队列变更为串行队列。</p>
<h3 id="2-6、关键字-Dispatch-Group"><a href="#2-6、关键字-Dispatch-Group" class="headerlink" title="2.6、关键字 - Dispatch Group"></a>2.6、关键字 - Dispatch Group</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">将原本在serialQueue中要执行的放在group里，后面可以加一个结束的回调（很多时候会有这种需求）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    dispatch_group_t <span class="keyword">group</span> = dispatch_group_create();</span><br><span class="line">    dispatch_group_async(<span class="keyword">group</span>, serialQueue, ^&#123;</span><br><span class="line">        <span class="comment">//代码</span></span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(<span class="keyword">group</span>, serialQueue, ^&#123;</span><br><span class="line">        <span class="comment">//代码</span></span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(<span class="keyword">group</span>, serialQueue, ^&#123;</span><br><span class="line">        <span class="comment">//代码</span></span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_notify(<span class="keyword">group</span>, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"done"</span>);<span class="comment">//执行完成后回调</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-7、关键字-dispatch-barrier-async-栅栏"><a href="#2-7、关键字-dispatch-barrier-async-栅栏" class="headerlink" title="2.7、关键字 - dispatch_barrier_async 栅栏"></a>2.7、关键字 - dispatch_barrier_async 栅栏</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t concurrentQueue = dispatch_queue_create(<span class="string">"abcd"</span>, DISPATCH_QUEUE_CONCURRENT);<span class="regexp">//</span>并行队列</span><br><span class="line">   dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">       [<span class="keyword">self</span> <span class="symbol">loadImage:</span><span class="variable">@0</span>];</span><br><span class="line">       /<span class="regexp">/读取数据0</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@1];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据1</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@2];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据2</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@3];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据3</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_barrier_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@4];</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/异步栅栏写入数据4</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_barrier_sync(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@4];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/同步栅栏写入数据4</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@5];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据5</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@6];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据6</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@7];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据7</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br><span class="line"><span class="regexp">   dispatch_async(concurrentQueue, ^&#123;</span></span><br><span class="line"><span class="regexp">       [self loadImage:@8];</span></span><br><span class="line"><span class="regexp">       /</span><span class="regexp">/读取数据8</span></span><br><span class="line"><span class="regexp">   &#125;);</span></span><br></pre></td></tr></table></figure>
<p>打印log：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">53.029</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543714</span>] 执行：<span class="number">2</span> 线程信息：&lt;NSThread: <span class="number">0x600000076d80</span>&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">53.029</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543650</span>] 执行：<span class="number">0</span> 线程信息：&lt;NSThread: <span class="number">0x600000076d40</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">53.029</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543652</span>] 执行：<span class="number">1</span> 线程信息：&lt;NSThread: <span class="number">0x608000066940</span>&gt;&#123;number = <span class="number">4</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">53.029</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543715</span>] 执行：<span class="number">3</span> 线程信息：&lt;NSThread: <span class="number">0x608000071140</span>&gt;&#123;number = <span class="number">6</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">58.763</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13544668</span>] 异步栅栏执行：<span class="number">4</span> 线程信息：&lt;NSThread: <span class="number">0x6080000710c0</span>&gt;&#123;number = <span class="number">8</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">01.195</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13542941</span>] 同步栅栏执行：<span class="number">4</span> 线程信息：&lt;NSThread: <span class="number">0x600000066500</span>&gt;&#123;number = <span class="number">1</span>, name = main&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03.605</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543650</span>] 执行：<span class="number">7</span> 线程信息：&lt;NSThread: <span class="number">0x600000076d40</span>&gt;&#123;number = <span class="number">3</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03.605</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13544677</span>] 执行：<span class="number">5</span> 线程信息：&lt;NSThread: <span class="number">0x608000074bc0</span>&gt;&#123;number = <span class="number">9</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03.605</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13544668</span>] 执行：<span class="number">6</span> 线程信息：&lt;NSThread: <span class="number">0x6080000710c0</span>&gt;&#123;number = <span class="number">8</span>, name = (<span class="literal">null</span>)&#125;</span><br><span class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-28</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">03.605</span> 多线程GCD[<span class="number">82699</span>:<span class="number">13543714</span>] 执行：<span class="number">8</span> 线程信息：&lt;NSThread: <span class="number">0x600000076d80</span>&gt;&#123;number = <span class="number">5</span>, name = (<span class="literal">null</span>)&#125;</span><br></pre></td></tr></table></figure>
<p>在读取数据时，有时候会出现数据竞争，数据安全问题，比如：当前的写入没有结束，读取操作就开始处理，导致数据错乱。或者读取正在进行，开始写入操作，导致程序崩溃等问题。<br>苹果为我们提供了一个便捷的参数：dispatch_barrier_async（栅栏）。<br><strong>作用</strong>：如上述代码中所表示，只有在1234操作完成时（无序），才会执行写入操作，只有当前写入操作结束后，才会继续向下执行。dispatch_barrier_sync也有同样的效果，但是如果不放入其他线程中的话，会在当前线程即主线程执行，会阻塞线程。</p>
<p><strong>注意</strong>：dispatch_barrier_async中如果使用全局队列的话，就相当于要等待全局队列里的所有并发任务执行完后，才会执行dispatch_barrier_async中的任务，这样会受其他在全局队列里任务的影响，达不到我们想要的效果。</p>
<h2 id="三、总结："><a href="#三、总结：" class="headerlink" title="三、总结："></a>三、总结：</h2><p> **<br>并发队列(Concurrent Dispatch Queue)  串行队列(Serial Dispatch Queue) ：<br>负责执行顺序！<br>异步执行 (dispatch_async)  同步执行 (dispatch_sync)：<br>负责选择线程执行！<br>**</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5-Core-Animation.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5-Core-Animation.html" class="post-title-link" itemprop="url">iOS开发系列-让你的应用“动”起来--Core-Animation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-02 11:56:05" itemprop="dateCreated datePublished" datetime="2017-03-02T11:56:05+08:00">2017-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>36k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>32 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          总结iOS中几种做动画的原理。
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/iOS%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5-Core-Animation.html">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5-CALayer.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5-CALayer.html" class="post-title-link" itemprop="url">iOS开发系列-让你的应用“动”起来--CALayer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-01 11:00:05" itemprop="dateCreated datePublished" datetime="2017-03-01T11:00:05+08:00">2017-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>14 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>在iOS中随处都可以看到绚丽的动画效果，实现这些动画的过程并不复杂，今天将带大家一窥iOS动画全貌。在这里你可以看到iOS中如何使用图层精简非交互式绘图，如何通过核心动画创建基础动画、关键帧动画、动画组、转场动画，如何通过UIView的装饰方法对这些动画操作进行简化等。在今天的文章里您可以看到动画操作在iOS中是如何简单和高效，很多原来想做但是苦于没有思路的动画在iOS中将变得越发简单：</p>
<blockquote>
<ul>
<li>CALayer:<ul>
<li>CALayer简介</li>
<li>CALayer常用属性</li>
<li>CALayer绘图</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="CALayer"><a href="#CALayer" class="headerlink" title="CALayer"></a>CALayer</h1><h2 id="1-CALayer简介"><a href="#1-CALayer简介" class="headerlink" title="1. CALayer简介"></a>1. CALayer简介</h2><p>在介绍动画操作之前我们必须先来了解一个动画中常用的对象CALayer。CALayer包含在QuartzCore框架中，这是一个跨平台的框架，既可以用在iOS中又可以用在Mac OS X中。在使用Core Animation开发动画的本质就是将CALayer中的内容转化为位图从而供硬件操作，所以要熟练掌握动画操作必须先来熟悉CALayer。</p>
<p>使用Quartz 2D绘图时大家其实已经用到了CALayer，当利用drawRect:方法绘图的本质就是绘制到了UIView的layer（属性）中，可是这个过程大家在上一节中根本体会不到。但是在Core Animation中我们操作更多的则不再是UIView而是直接面对CALayer。下图描绘了CALayer和UIView的关系，在UIView中有一个layer属性作为根图层，根图层上可以放其他子图层，在UIView中所有能够看到的内容都包含在layer中：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-1436b711fc0fd157.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<hr>
<h2 id="2-CALayer常用属性"><a href="#2-CALayer常用属性" class="headerlink" title="2. CALayer常用属性"></a>2. CALayer常用属性</h2><p>在iOS中CALayer的设计主要是了为了内容展示和动画操作，CALayer本身并不包含在UIKit中，它不能响应事件。由于CALayer在设计之初就考虑它的动画操作功能，CALayer很多属性在修改时都能形成动画效果，这种属性称为“隐式动画属性”。但是对于UIView的根图层而言属性的修改并不形成动画效果，因为很多情况下根图层更多的充当容器的做用，如果它的属性变动形成动画效果会直接影响子图层。另外，UIView的根图层创建工作完全由iOS负责完成，无法重新创建，但是可以往根图层中添加子图层或移除子图层。</p>
<p>下表列出了CALayer常用的属性：</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th>说明</th>
<th align="center">是否支持隐式动画</th>
</tr>
</thead>
<tbody><tr>
<td align="center">anchorPoint</td>
<td>和中心点position重合的一个点，称为“锚点”，锚点的描述是相对于x、y位置比例而言的默认在图像中心点(0.5,0.5)的位置</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">backgroundColor</td>
<td>图层背景颜色</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">borderColor</td>
<td>边框颜色</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">borderWidth</td>
<td>边框宽度</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">bounds</td>
<td>图层大小</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">contents</td>
<td>图层显示内容，例如可以将图片作为图层内容显示</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">contentsRect</td>
<td>图层显示内容的大小和位置</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">cornerRadius</td>
<td>圆角半径</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">doubleSided</td>
<td>图层背面是否显示，默认为YES</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">frame</td>
<td>图层大小和位置，不支持隐式动画，所以CALayer中很少使用frame，通常使用bounds和position代替</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">hidden</td>
<td>是否隐藏</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">mask</td>
<td>图层蒙版</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">maskToBounds</td>
<td>子图层是否剪切图层边界，默认为NO</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">opacity</td>
<td>透明度 ，类似于UIView的alpha</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">position</td>
<td>图层中心点位置，类似于UIView的center</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">shadowColor</td>
<td>阴影颜色</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">shadowOffset</td>
<td>阴影偏移量</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">shadowOpacity</td>
<td>阴影透明度，注意默认为0，如果设置阴影必须设置此属性</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">shadowPath</td>
<td>阴影的形状</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">shadowRadius</td>
<td>阴影模糊半径</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">sublayers</td>
<td>子图层</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">sublayerTransform</td>
<td>子图层形变</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">transform</td>
<td>图层形变</td>
<td align="center">是</td>
</tr>
</tbody></table>
<ul>
<li>隐式属性动画的本质是这些属性的变动默认隐含了CABasicAnimation动画实现，详情大家可以参照Xcode帮助文档中“Animatable Properties”一节。</li>
<li>在CALayer中很少使用frame属性，因为frame本身不支持动画效果，通常使用bounds和position代替。</li>
<li>CALayer中透明度使用opacity表示而不是alpha；中心点使用position表示而不是center。</li>
<li>anchorPoint属性是图层的锚点，范围在（0<del>1,0</del>1）表示在x、y轴的比例，这个点永远可以同position（中心点）重合，当图层中心点固定后，调整anchorPoint即可达到调整图层显示位置的作用（因为它永远和position重合）</li>
</ul>
<p>为了进一步说明anchorPoint的作用，假设有一个层大小100*100，现在中心点位置（50,50），由此可以得出frame（0,0,100,100）。上面说过anchorPoint默认为（0.5,0.5），同中心点position重合，此时使用图形描述如图1；当修改anchorPoint为（0,0），此时锚点处于图层左上角，但是中心点poition并不会改变，因此图层会向右下角移动，如图2；然后修改anchorPoint为（1,1,），position还是保持位置不变，锚点处于图层右下角，此时图层如图3。<br><img src="http://upload-images.jianshu.io/upload_images/2647951-cab9986817414c4e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>下面通过一个简单的例子演示一下上面几个属性，程序初始化阶段我们定义一个正方形，但是圆角路径调整为正方形边长的一半，使其看起来是一个圆形，在点击屏幕的时候修改图层的属性形成动画效果（注意在程序中没有直接修改UIView的layer属性，因为根图层无法形成动画效果）：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  KCMainViewController.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIDTH 50</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	[<span class="keyword">self</span> drawMyLayer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark 绘制图层</span></span><br><span class="line">-(<span class="keyword">void</span>)drawMyLayer&#123;</span><br><span class="line">	<span class="built_in">CGSize</span> size=[<span class="built_in">UIScreen</span> mainScreen].bounds.size;</span><br><span class="line">	<span class="comment">//获得根图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layer=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	<span class="comment">//设置背景颜色,由于QuartzCore是跨平台框架，无法直接使用UIColor</span></span><br><span class="line">	layer.backgroundColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">146</span>/<span class="number">255.0</span> blue:<span class="number">1.0</span> alpha:<span class="number">1.0</span>].CGColor;</span><br><span class="line">	<span class="comment">//设置中心点</span></span><br><span class="line">	layer.position=<span class="built_in">CGPointMake</span>(size.width/<span class="number">2</span>, size.height/<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//设置大小</span></span><br><span class="line">	layer.bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, WIDTH,WIDTH);</span><br><span class="line">	<span class="comment">//设置圆角,当圆角半径等于矩形的一半时看起来就是一个圆形</span></span><br><span class="line">	layer.cornerRadius=WIDTH/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//设置阴影</span></span><br><span class="line">	layer.shadowColor=[<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">	layer.shadowOffset=<span class="built_in">CGSizeMake</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">	layer.shadowOpacity=<span class="number">.9</span>;</span><br><span class="line">	<span class="comment">//设置边框</span></span><br><span class="line">	<span class="comment">//    layer.borderColor=[UIColor whiteColor].CGColor;</span></span><br><span class="line">	<span class="comment">//    layer.borderWidth=1;</span></span><br><span class="line">	<span class="comment">//   设置锚点</span></span><br><span class="line">	<span class="comment">//    layer.anchorPoint=CGPointZero;</span></span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark 点击放大</span></span><br><span class="line">-(<span class="keyword">void</span>)touchesEnded:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">UITouch</span> *touch=[touches anyObject];</span><br><span class="line">	<span class="built_in">CALayer</span> *layer=<span class="keyword">self</span>.view.layer.sublayers[<span class="number">0</span>];</span><br><span class="line">	<span class="built_in">CGFloat</span> width=layer.bounds.size.width;</span><br><span class="line">	<span class="keyword">if</span> (width==WIDTH) &#123;</span><br><span class="line">	width=WIDTH*<span class="number">4</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	width=WIDTH;</span><br><span class="line">	&#125;</span><br><span class="line">	layer.bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, width);</span><br><span class="line">	layer.position=[touch locationInView:<span class="keyword">self</span>.view];</span><br><span class="line">	layer.cornerRadius=width/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-b3a99537419dce31.gif?imageMogr2/auto-orient/strip" alt></p>
<hr>
<h2 id="3-CALayer绘图"><a href="#3-CALayer绘图" class="headerlink" title="3. CALayer绘图"></a>3. CALayer绘图</h2><p>在使用Quartz 2D绘图时，当调用了UIView的drawRect:方法绘制图形、图像，这种方式本质还是在图层中绘制，但是这里会着重介绍一下如何直接在图层中绘图。在图层中绘图的方式跟原来基本没有区别，只是drawRect:方法是由UIKit组件进行调用，因此里面可以使用一些UIKit封装的方法进行绘图，而直接绘制到图层的方法由于并非UIKit直接调用因此只能用原生的Core Graphics方法绘制。</p>
<p>图层绘图有两种方法，不管使用哪种方法绘制完必须调用图层的setNeedDisplay方法（注意是图层的方法，不是UIView的方法，前面我们介绍过UIView也有此方法）</p>
<ol>
<li>通过图层代理drawLayer: inContext:方法绘制</li>
<li>通过自定义图层drawInContext:方法绘制</li>
</ol>
<h3 id="3-1、使用代理方法绘图"><a href="#3-1、使用代理方法绘图" class="headerlink" title="3.1、使用代理方法绘图"></a>3.1、使用代理方法绘图</h3><p>通过代理方法进行图层绘图只要指定图层的代理，然后在代理对象中重写<strong>-(void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</strong>方法即可。需要注意这个方法虽然是代理方法但是不用手动实现CALayerDelegate，因为CALayer定义中给NSObject做了分类扩展，所有的NSObject都包含这个方法。另外设置完代理后必须要调用图层的setNeedDisplay方法，否则绘制的内容无法显示。</p>
<p>下面的代码演示了在一个自定义图层绘制一张图像并将图像设置成圆形，这种效果在很多应用中很常见，如最新版的手机QQ头像就是这种效果：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  KCMainViewController.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHOTO_HEIGHT 150</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad </span><br><span class="line">&#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="comment">//自定义图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layer=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layer.bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT);</span><br><span class="line">	layer.position=<span class="built_in">CGPointMake</span>(<span class="number">160</span>, <span class="number">200</span>);</span><br><span class="line">	layer.backgroundColor=[<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">	layer.cornerRadius=PHOTO_HEIGHT/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//注意仅仅设置圆角，对于图形而言可以正常显示，但是对于图层中绘制的图片无法正确显示</span></span><br><span class="line">	<span class="comment">//如果想要正确显示则必须设置masksToBounds=YES，剪切子图层</span></span><br><span class="line">	layer.masksToBounds=<span class="literal">YES</span>;</span><br><span class="line">	<span class="comment">//阴影效果无法和masksToBounds同时使用，因为masksToBounds的目的就是剪切外边框，而阴影效果刚好在外边框</span></span><br><span class="line">	<span class="comment">//    layer.shadowColor=[UIColor grayColor].CGColor;</span></span><br><span class="line">	<span class="comment">//    layer.shadowOffset=CGSizeMake(2, 2);</span></span><br><span class="line">	<span class="comment">//    layer.shadowOpacity=1;</span></span><br><span class="line">	<span class="comment">//设置边框</span></span><br><span class="line">	layer.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layer.borderWidth=<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//设置图层代理</span></span><br><span class="line">	layer.delegate=<span class="keyword">self</span>;</span><br><span class="line">	<span class="comment">//添加图层到根图层</span></span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">	<span class="comment">//调用图层setNeedDisplay,否则代理方法不会被调用</span></span><br><span class="line">	[layer setNeedsDisplay];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">#<span class="meta-keyword">pragma</span> mark 绘制图形、图像到图层，注意参数中的ctx是图层的图形上下文，其中绘图位置也是相对图层而言的</span></span><br><span class="line">	-(<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line">	<span class="comment">//    NSLog(@"%@",layer);//这个图层正是上面定义的图层</span></span><br><span class="line">	<span class="built_in">CGContextSaveGState</span>(ctx);</span><br><span class="line">	<span class="comment">//图形上下文形变，解决图片倒立的问题</span></span><br><span class="line">	<span class="built_in">CGContextScaleCTM</span>(ctx, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">	<span class="built_in">CGContextTranslateCTM</span>(ctx, <span class="number">0</span>, -PHOTO_HEIGHT);</span><br><span class="line">	<span class="built_in">UIImage</span> *image=[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"photo.png"</span>];</span><br><span class="line">	<span class="comment">//注意这个位置是相对于图层而言的不是屏幕</span></span><br><span class="line">	<span class="built_in">CGContextDrawImage</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT), image.CGImage);</span><br><span class="line">	<span class="comment">//    CGContextFillRect(ctx, CGRectMake(0, 0, 100, 100));</span></span><br><span class="line">	<span class="comment">//    CGContextDrawPath(ctx, kCGPathFillStroke);</span></span><br><span class="line">	<span class="built_in">CGContextRestoreGState</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-983f8fbeb04c3dea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>使用代理方法绘制图形、图像时在drawLayer:inContext:方法中可以通过事件参数获得绘制的图层和图形上下文。在这个方法中绘图时所有的位置都是相对于图层而言的，图形上下文指的也是当前图层的图形上下文。</p>
<p>需要注意的是上面代码中绘制图片圆形裁切效果时如果不设置masksToBounds是无法显示圆形，但是对于其他图形却没有这个限制。原因就是当绘制一张图片到图层上的时候会重新创建一个图层添加到当前图层，这样一来如果设置了圆角之后虽然底图层有圆角效果，但是子图层还是矩形，只有设置了masksToBounds为YES让子图层按底图层剪切才能显示圆角效果。同样的，有些朋友经常在网上提问说为什么使用UIImageView的layer设置圆角后图片无法显示圆角，只有设置masksToBounds才能出现效果，也是类似的问题。</p>
<h4 id="3-1-1、扩展1–带阴影效果的圆形图片裁切"><a href="#3-1-1、扩展1–带阴影效果的圆形图片裁切" class="headerlink" title="3.1.1、扩展1–带阴影效果的圆形图片裁切"></a>3.1.1、扩展1–带阴影效果的圆形图片裁切</h4><p>如果设置了masksToBounds=YES之后确实可以显示图片圆角效果，但遗憾的是设置了这个属性之后就无法设置阴影效果。因为masksToBounds=YES就意味着外边框不能显示，而阴影恰恰作为外边框绘制的，这样两个设置就产生了矛盾。要解决这个问题不妨换个思路:使用两个大小一样的图层，下面的图层负责绘制阴影，上面的图层用来显示图片。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  KCMainViewController.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHOTO_HEIGHT 150</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="built_in">CGPoint</span> position= <span class="built_in">CGPointMake</span>(<span class="number">160</span>, <span class="number">200</span>);</span><br><span class="line">	<span class="built_in">CGRect</span> bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT);</span><br><span class="line">	<span class="built_in">CGFloat</span> cornerRadius=PHOTO_HEIGHT/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">CGFloat</span> borderWidth=<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//阴影图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layerShadow=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layerShadow.bounds=bounds;</span><br><span class="line">	layerShadow.position=position;</span><br><span class="line">	layerShadow.cornerRadius=cornerRadius;</span><br><span class="line">	layerShadow.shadowColor=[<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">	layerShadow.shadowOffset=<span class="built_in">CGSizeMake</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">	layerShadow.shadowOpacity=<span class="number">1</span>;</span><br><span class="line">	layerShadow.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layerShadow.borderWidth=borderWidth;</span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layerShadow];</span><br><span class="line">	<span class="comment">//容器图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layer=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layer.bounds=bounds;</span><br><span class="line">	layer.position=position;</span><br><span class="line">	layer.backgroundColor=[<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">	layer.cornerRadius=cornerRadius;</span><br><span class="line">	layer.masksToBounds=<span class="literal">YES</span>;</span><br><span class="line">	layer.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layer.borderWidth=borderWidth;</span><br><span class="line">	<span class="comment">//设置图层代理</span></span><br><span class="line">	layer.delegate=<span class="keyword">self</span>;</span><br><span class="line">	<span class="comment">//添加图层到根图层</span></span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">	<span class="comment">//调用图层setNeedDisplay,否则代理方法不会被调用</span></span><br><span class="line">	[layer setNeedsDisplay];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark 绘制图形、图像到图层，注意参数中的ctx是图层的图形上下文，其中绘图位置也是相对图层而言的</span></span><br><span class="line">-(<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line">	<span class="comment">//    NSLog(@"%@",layer);//这个图层正是上面定义的图层</span></span><br><span class="line">	<span class="built_in">CGContextSaveGState</span>(ctx);</span><br><span class="line">	<span class="comment">//图形上下文形变，解决图片倒立的问题</span></span><br><span class="line">	<span class="built_in">CGContextScaleCTM</span>(ctx, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">	<span class="built_in">CGContextTranslateCTM</span>(ctx, <span class="number">0</span>, -PHOTO_HEIGHT);</span><br><span class="line">	<span class="built_in">UIImage</span> *image=[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"photo.jpg"</span>];</span><br><span class="line">	<span class="comment">//注意这个位置是相对于图层而言的不是屏幕</span></span><br><span class="line">	<span class="built_in">CGContextDrawImage</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT), image.CGImage);</span><br><span class="line">	<span class="comment">//    CGContextFillRect(ctx, CGRectMake(0, 0, 100, 100));</span></span><br><span class="line">	<span class="comment">//    CGContextDrawPath(ctx, kCGPathFillStroke);</span></span><br><span class="line">	<span class="built_in">CGContextRestoreGState</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2647951-0ce398f485925bea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="3-1-2、扩展2–图层的形变"><a href="#3-1-2、扩展2–图层的形变" class="headerlink" title="3.1.2、扩展2–图层的形变"></a>3.1.2、扩展2–图层的形变</h4><p>从上面代码中大家不难发现使用Core Graphics绘制图片时会倒立显示，对图层的图形上下文进行了反转。在前一篇文章中也采用了类似的方法去解决这个问题，但是在那篇文章中也提到过如果直接让图像沿着x轴旋转180度同样可以达到正确显示的目的，只是当时的旋转靠图形上下文还无法绕x轴旋转。今天学习了图层之后，其实可以控制图层直接旋转而不用借助于图形上下文的形变操作，而且这么操作起来会更加简单和直观。对于上面的程序，只需要设置图层的transform属性即可。需要注意的是transform是CATransform3D类型，形变可以在三个维度上进行，使用方法和前面介绍的二维形变是类似的，而且都有对应的形变设置方法（如：CATransform3DMakeTranslation()、CATransform3DMakeScale()、CATransform3DMakeRotation()）。下面的代码通过CATransform3DMakeRotation()方法在x轴旋转180度解决倒立问题：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  形变演示</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHOTO_HEIGHT 150</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="built_in">CGPoint</span> position= <span class="built_in">CGPointMake</span>(<span class="number">160</span>, <span class="number">200</span>);</span><br><span class="line">	<span class="built_in">CGRect</span> bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT);</span><br><span class="line">	<span class="built_in">CGFloat</span> cornerRadius=PHOTO_HEIGHT/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">CGFloat</span> borderWidth=<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//阴影图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layerShadow=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layerShadow.bounds=bounds;</span><br><span class="line">	layerShadow.position=position;</span><br><span class="line">	layerShadow.cornerRadius=cornerRadius;</span><br><span class="line">	layerShadow.shadowColor=[<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">	layerShadow.shadowOffset=<span class="built_in">CGSizeMake</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">	layerShadow.shadowOpacity=<span class="number">1</span>;</span><br><span class="line">	layerShadow.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layerShadow.borderWidth=borderWidth;</span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layerShadow];</span><br><span class="line">	<span class="comment">//容器图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layer=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layer.bounds=bounds;</span><br><span class="line">	layer.position=position;</span><br><span class="line">	layer.backgroundColor=[<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">	layer.cornerRadius=cornerRadius;</span><br><span class="line">	layer.masksToBounds=<span class="literal">YES</span>;</span><br><span class="line">	layer.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layer.borderWidth=borderWidth;</span><br><span class="line">	<span class="comment">//利用图层形变解决图像倒立问题</span></span><br><span class="line">	layer.transform=<span class="built_in">CATransform3DMakeRotation</span>(M_PI, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//设置图层代理</span></span><br><span class="line">	layer.delegate=<span class="keyword">self</span>;</span><br><span class="line">	<span class="comment">//添加图层到根图层</span></span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">	<span class="comment">//调用图层setNeedDisplay,否则代理方法不会被调用</span></span><br><span class="line">	[layer setNeedsDisplay];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark 绘制图形、图像到图层，注意参数中的ctx时图层的图形上下文，其中绘图位置也是相对图层而言的</span></span><br><span class="line">-(<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line">	<span class="comment">//    NSLog(@"%@",layer);//这个图层正是上面定义的图层</span></span><br><span class="line">	<span class="built_in">UIImage</span> *image=[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"photo.jpg"</span>];</span><br><span class="line">	<span class="comment">//注意这个位置是相对于图层而言的不是屏幕</span></span><br><span class="line">	<span class="built_in">CGContextDrawImage</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT), image.CGImage);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>事实上如果仅仅就显示一张图片在图层中当然没有必要那么麻烦，直接设置图层contents就可以了，不牵涉到绘图也就没有倒立的问题了。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  图层内容设置</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHOTO_HEIGHT 150</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	<span class="built_in">CGPoint</span> position= <span class="built_in">CGPointMake</span>(<span class="number">160</span>, <span class="number">200</span>);</span><br><span class="line">	<span class="built_in">CGRect</span> bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, PHOTO_HEIGHT, PHOTO_HEIGHT);</span><br><span class="line">	<span class="built_in">CGFloat</span> cornerRadius=PHOTO_HEIGHT/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">CGFloat</span> borderWidth=<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//阴影图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layerShadow=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layerShadow.bounds=bounds;</span><br><span class="line">	layerShadow.position=position;</span><br><span class="line">	layerShadow.cornerRadius=cornerRadius;</span><br><span class="line">	layerShadow.shadowColor=[<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">	layerShadow.shadowOffset=<span class="built_in">CGSizeMake</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">	layerShadow.shadowOpacity=<span class="number">1</span>;</span><br><span class="line">	layerShadow.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layerShadow.borderWidth=borderWidth;</span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layerShadow];</span><br><span class="line">	<span class="comment">//容器图层</span></span><br><span class="line">	<span class="built_in">CALayer</span> *layer=[[<span class="built_in">CALayer</span> alloc]init];</span><br><span class="line">	layer.bounds=bounds;</span><br><span class="line">	layer.position=position;</span><br><span class="line">	layer.backgroundColor=[<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">	layer.cornerRadius=cornerRadius;</span><br><span class="line">	layer.masksToBounds=<span class="literal">YES</span>;</span><br><span class="line">	layer.borderColor=[<span class="built_in">UIColor</span> whiteColor].CGColor;</span><br><span class="line">	layer.borderWidth=borderWidth;</span><br><span class="line">	<span class="comment">//设置内容（注意这里一定要转换为CGImage）</span></span><br><span class="line">	<span class="built_in">UIImage</span> *image=[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"photo.jpg"</span>];</span><br><span class="line">	<span class="comment">//    layer.contents=(id)image.CGImage;</span></span><br><span class="line">	[layer setContents:(<span class="keyword">id</span>)image.CGImage];</span><br><span class="line">	<span class="comment">//添加图层到根图层</span></span><br><span class="line">	[<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>既然如此为什么还大费周章的说形变呢，因为形变对于动画有特殊的意义。在动画开发中形变往往不是直接设置transform，而是通过keyPath进行设置。这种方法设置形变的本质和前面没有区别，只是利用了KVC可以动态修改其属性值而已，但是这种方式在动画中确实很常用的，因为它可以很方便的将几种形变组合到一起使用。同样是解决动画旋转问题，只要将前面的旋转代码改为下面的代码即可：</p>
<blockquote>
<p>[layer setValue:@M_PI forKeyPath:@”transform.rotation.x”];</p>
</blockquote>
<p>当然，通过key path设置形变参数就需要了解有哪些key path可以设置，这里就不再一一列举，大家可以参照Xcode帮助文档中“CATransform3D Key Paths”一节，里面描述的很详细。</p>
<h3 id="3-2、使用自定义图层绘图"><a href="#3-2、使用自定义图层绘图" class="headerlink" title="3.2、使用自定义图层绘图"></a>3.2、使用自定义图层绘图</h3><p>在自定义图层中绘图时只要自己编写一个类继承于CALayer然后在drawInContext:中绘图即可。同前面在代理方法绘图一样，要显示图层中绘制的内容也要调用图层的setNeedDisplay方法，否则drawInContext方法将不会调用。</p>
<p>在使用Quartz 2D在UIView中绘制图形的本质也是绘制到图层中，为了说明这个问题下面演示自定义图层绘图时没有直接在视图控制器中调用自定义图层，而是在一个UIView将自定义图层添加到UIView的根图层中（例子中的UIView跟自定义图层绘图没有直接关系）。从下面的代码中可以看到：UIView在显示时其根图层会自动创建一个CGContextRef（CALayer本质使用的是位图上下文），同时调用图层代理（UIView创建图层会自动设置图层代理为其自身）的<strong>draw: inContext:</strong>方法并将图形上下文作为参数传递给这个方法。而在UIView的<strong>draw:inContext:</strong>方法中会调用其drawRect:方法，在<strong>drawRect:</strong>方法中使用<strong>UIGraphicsGetCurrentContext()</strong>方法得到的上下文正是前面创建的上下文。<br>KCLayer.m</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  KCLayer.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"KCLayer.h"</span></span><br><span class="line">@implementation KCLayer</span><br><span class="line">-(<span class="built_in">void</span>)drawInContext:(CGContextRef)ctx&#123;</span><br><span class="line">	NSLog(@<span class="string">"3-drawInContext:"</span>);</span><br><span class="line">	NSLog(@<span class="string">"CGContext:%@"</span>,ctx);</span><br><span class="line">	<span class="comment">//    CGContextRotateCTM(ctx, M_PI_4);</span></span><br><span class="line">	CGContextSetRGBFillColor(ctx, <span class="number">135.0</span>/<span class="number">255.0</span>, <span class="number">232.0</span>/<span class="number">255.0</span>, <span class="number">84.0</span>/<span class="number">255.0</span>, <span class="number">1</span>);</span><br><span class="line">	CGContextSetRGBStrokeColor(ctx, <span class="number">135.0</span>/<span class="number">255.0</span>, <span class="number">232.0</span>/<span class="number">255.0</span>, <span class="number">84.0</span>/<span class="number">255.0</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//    CGContextFillRect(ctx, CGRectMake(0, 0, 100, 100));</span></span><br><span class="line">	<span class="comment">//    CGContextFillEllipseInRect(ctx, CGRectMake(50, 50, 100, 100));</span></span><br><span class="line">	CGContextMoveToPoint(ctx, <span class="number">94.5</span>, <span class="number">33.5</span>);</span><br><span class="line">	<span class="comment">//// Star Drawing</span></span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">104.02</span>, <span class="number">47.39</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">120.18</span>, <span class="number">52.16</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">109.91</span>, <span class="number">65.51</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">110.37</span>, <span class="number">82.34</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">94.5</span>, <span class="number">76.7</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">78.63</span>, <span class="number">82.34</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">79.09</span>, <span class="number">65.51</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">68.82</span>, <span class="number">52.16</span>);</span><br><span class="line">	CGContextAddLineToPoint(ctx,<span class="number">84.98</span>, <span class="number">47.39</span>);</span><br><span class="line">	CGContextClosePath(ctx);</span><br><span class="line">	CGContextDrawPath(ctx, kCGPathFillStroke);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>KCView.m</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  KCView.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCLayer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCView</span></span></span><br><span class="line">-(<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame&#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"initWithFrame:"</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span>=[<span class="keyword">super</span> initWithFrame:frame]) </span><br><span class="line">	&#123;</span><br><span class="line">		KCLayer *layer=[[KCLayer alloc]init];</span><br><span class="line">		layer.bounds=<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">185</span>, <span class="number">185</span>);</span><br><span class="line">		layer.position=<span class="built_in">CGPointMake</span>(<span class="number">160</span>,<span class="number">284</span>);</span><br><span class="line">		layer.backgroundColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">146</span>/<span class="number">255.0</span> blue:<span class="number">1.0</span> alpha:<span class="number">1.0</span>].CGColor;</span><br><span class="line">		<span class="comment">//显示图层</span></span><br><span class="line">		[layer setNeedsDisplay];</span><br><span class="line">		[<span class="keyword">self</span>.layer addSublayer:layer];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"2-drawRect:"</span>);</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"CGContext:%@"</span>,<span class="built_in">UIGraphicsGetCurrentContext</span>());<span class="comment">//得到的当前图形上下文正是drawLayer中传递的</span></span><br><span class="line">	[<span class="keyword">super</span> drawRect:rect];</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"1-drawLayer:inContext:"</span>);</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"CGContext:%@"</span>,ctx);</span><br><span class="line">	[<span class="keyword">super</span> drawLayer:layer inContext:ctx];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>KCMainViewController.m</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  KCMainViewController.m</span></span><br><span class="line"><span class="comment">//  CALayer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Kenshin Cui on 14-3-22.</span></span><br><span class="line"><span class="comment">//  Copyright (c) 2014年 Kenshin Cui. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCMainViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"KCView.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">KCMainViewController</span> ()</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">KCMainViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">	KCView *view=[[KCView alloc]initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">	view.backgroundColor=[<span class="built_in">UIColor</span> colorWithRed:<span class="number">249.0</span>/<span class="number">255.0</span> green:<span class="number">249.0</span>/<span class="number">255.0</span> blue:<span class="number">249.0</span>/<span class="number">255.0</span> alpha:<span class="number">1</span>];</span><br><span class="line">	[<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行效果：<br><img src="http://upload-images.jianshu.io/upload_images/2647951-37d68836198e596b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS-%E7%94%BB%E8%99%9A%E7%BA%BF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS-%E7%94%BB%E8%99%9A%E7%BA%BF%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F.html" class="post-title-link" itemprop="url">iOS-画虚线的几种方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-24 10:50:15" itemprop="dateCreated datePublished" datetime="2017-02-24T10:50:15+08:00">2017-02-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、重写drawRect方法"><a href="#一、重写drawRect方法" class="headerlink" title="一、重写drawRect方法"></a>一、重写drawRect方法</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> - (void)drawRect:(CGRect)rect</span><br><span class="line">&#123; </span><br><span class="line">	<span class="literal">[<span class="identifier">super</span> <span class="identifier">drawRect</span>:<span class="identifier">rect</span>]</span>;</span><br><span class="line">	 CGContextRef currentContext = <span class="constructor">UIGraphicsGetCurrentContext()</span>; </span><br><span class="line">	 <span class="comment">//设置虚线颜色 </span></span><br><span class="line">	 <span class="constructor">CGContextSetStrokeColorWithColor(<span class="params">currentContext</span>, [UIColor BlackColor].CGColor)</span>; </span><br><span class="line">	 <span class="comment">//设置虚线宽度 </span></span><br><span class="line">	 <span class="constructor">CGContextSetLineWidth(<span class="params">currentContext</span>, 1)</span>; </span><br><span class="line">	 <span class="comment">//设置虚线绘制起点 </span></span><br><span class="line">	 <span class="constructor">CGContextMoveToPoint(<span class="params">currentContext</span>, 0, 0)</span>; </span><br><span class="line">	 <span class="comment">//设置虚线绘制终点 </span></span><br><span class="line">	 <span class="constructor">CGContextAddLineToPoint(<span class="params">currentContext</span>, <span class="params">self</span>.<span class="params">frame</span>.<span class="params">origin</span>.<span class="params">x</span> + <span class="params">self</span>.<span class="params">frame</span>.<span class="params">size</span>.<span class="params">width</span>, 0)</span>; <span class="comment">//设置虚线排列的宽度间隔:下面的arr中的数字表示先绘制3个点再绘制1个点 </span></span><br><span class="line">	 CGFloat arr<span class="literal">[]</span> = &#123;<span class="number">3</span>,<span class="number">1</span>&#125;; </span><br><span class="line">	 <span class="comment">//下面最后一个参数“2”代表排列的个数。 </span></span><br><span class="line">	 <span class="constructor">CGContextSetLineDash(<span class="params">currentContext</span>, 0, <span class="params">arr</span>, 2)</span>; </span><br><span class="line">	 <span class="constructor">CGContextDrawPath(<span class="params">currentContext</span>, <span class="params">kCGPathStroke</span>)</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看着这些代码肯定有一部分人头疼，因为一般开发绘图部分用的比较少，特别是很少接触这些东西的人，甚至对绘图这部分的只是已经忘光了，所以在这里自己也脑补一下。<strong>以下来自转载</strong><br>iOS的绘图操作是在UIView类的drawRect方法中完成的，所以如果我们要想在一个UIView中绘图，需要写一个扩展UIView 的类，并重写drawRect方法，在这里进行绘图操作，程序会自动调用此方法进行绘图。下面先说明一下绘图，比如，你想绘制一个方块，你需要写一个类来扩展UIView并在drawRect方法中填入如下代码：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (void)drawRect:(CGRect)rect &#123; </span><br><span class="line">	<span class="comment">// Drawing code. </span></span><br><span class="line">	<span class="comment">//获得处理的上下文 </span></span><br><span class="line">	CGContextRef context = <span class="constructor">UIGraphicsGetCurrentContext()</span>; </span><br><span class="line">	<span class="comment">//设置线条样式 </span></span><br><span class="line">	<span class="constructor">CGContextSetLineCap(<span class="params">context</span>, <span class="params">kCGLineCapSquare</span>)</span>; </span><br><span class="line">	<span class="comment">//设置线条粗细宽度 </span></span><br><span class="line">	<span class="constructor">CGContextSetLineWidth(<span class="params">context</span>, 1.0)</span>; </span><br><span class="line">	<span class="comment">//设置颜色 </span></span><br><span class="line">	<span class="constructor">CGContextSetRGBStrokeColor(<span class="params">context</span>, 1.0, 0.0, 0.0, 1.0)</span>; </span><br><span class="line">	<span class="comment">//开始一个起始路径 </span></span><br><span class="line">	<span class="constructor">CGContextBeginPath(<span class="params">context</span>)</span>; </span><br><span class="line">	<span class="comment">//起始点设置为(0,0):注意这是上下文对应区域中的相对坐标 </span></span><br><span class="line">	<span class="constructor">CGContextMoveToPoint(<span class="params">context</span>, 0, 0)</span>; </span><br><span class="line">	<span class="comment">//设置下一个坐标点 </span></span><br><span class="line">	<span class="constructor">CGContextAddLineToPoint(<span class="params">context</span>, 100, 100)</span>; </span><br><span class="line">	/设置下一个坐标点 </span><br><span class="line">	<span class="constructor">CGContextAddLineToPoint(<span class="params">context</span>, 0, 150)</span>; </span><br><span class="line">	<span class="comment">//设置下一个坐标点 CGContextAddLineToPoint(context, 50, 180); </span></span><br><span class="line">	<span class="comment">//连接上面定义的坐标点 </span></span><br><span class="line">	<span class="constructor">CGContextStrokePath(<span class="params">context</span>)</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再说明一下重绘，重绘操作仍然在drawRect方法中完成，但是苹果不建议直接调用drawRect方法，当然如果你强行直接调用此方法，当然是没有效果的。苹果要求我们调用UIView类中的setNeedsDisplay方法，则程序会自动调用drawRect方法进行重绘（调用setNeedsDisplay会自动调用drawRect）。<br>在UIView中,重写drawRect: (CGRect)aRect方法,可以自己定义想要画的图案.且此方法一般情况下只会画一次.也就是说这个drawRect方法一般情况下只会被掉用一次。当某些情况下想要手动重画这个View,只需要掉用<strong>[self setNeedsDisplay]</strong>方法即可.<br>drawRect的执行顺序及注意<br><strong>drawRect调是在Controller-&gt;loadView, Controller-&gt;viewDidLoad 两方法之后掉用的</strong>.<br>如果在UIView初始化时没有设置rect大小，将直接导致drawRect不被自动调用。<br>该方法在调用sizeThatFits后被调用，所以可以先调用sizeToFit计算出size。然后系统自动调用drawRect:方法。<br>通过设置contentMode属性值为UIViewContentModeRedraw。那么将在每次设置或更改frame的时候自动调用drawRect:。<br>直接调用setNeedsDisplay，或者setNeedsDisplayInRect:触发drawRect:，但是有个前提条件是rect不能为0.</p>
<blockquote>
<p>以上1,2推荐；而3,4不提倡<br>若使用UIView绘图，只能在drawRect：方法中获取相应的contextRef并绘图。如果在其他方法中获取将获取到一个invalidate的ref并且不能用于画图。drawRect：方法不能手动显示调用，必须通过调用setNeedsDisplay 或者 setNeedsDisplayInRect ，让系统自动调该方法。若使用calayer绘图，只能在drawInContext:中（类似鱼drawRect）绘制，或者在delegate中的相应方法绘制。同样也是调用setNeedDisplay等间接调用以上方法。若要实时画图，不能使用gestureRecognizer，只能使用touchbegan等方法来掉用setNeedsDisplay实时刷新屏幕转载地址：<a href="http://blog.csdn.net/fww330666557/article/details/8647608" target="_blank" rel="noopener">http://blog.csdn.net/fww330666557/article/details/8647608</a></p>
</blockquote>
<h2 id="二、通过UIImage的绘图方法来绘制"><a href="#二、通过UIImage的绘图方法来绘制" class="headerlink" title="二、通过UIImage的绘图方法来绘制"></a>二、通过UIImage的绘图方法来绘制</h2><p>// 画虚线// 创建一个imageView 高度是你想要的虚线的高度 一般设为2<br>_lineImg = [[UIImageView alloc] initWithFrame:CGRectMake(0, 20, kScreenWidth, 2)];<br>// 调用方法 返回的iamge就是虚线<br>_lineImg.image = [self drawLineByImageView:_lineImg];<br>// 添加到控制器的view上<br>[self.view addSubview:_lineImg];<br>// 返回虚线image的方法</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (UIImage *)drawLineByImageView:(UIImageView *)imageView</span><br><span class="line">&#123; </span><br><span class="line">	<span class="constructor">UIGraphicsBeginImageContext(<span class="params">imageView</span>.<span class="params">frame</span>.<span class="params">size</span>)</span>;</span><br><span class="line">	<span class="comment">//开始画线 划线的frame </span></span><br><span class="line">	<span class="literal">[<span class="identifier">imageView</span>.<span class="identifier">image</span> <span class="identifier">drawInRect</span>:CGR<span class="identifier">ectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="identifier">imageView</span>.<span class="identifier">frame</span>.<span class="identifier">size</span>.<span class="identifier">width</span>, <span class="identifier">imageView</span>.<span class="identifier">frame</span>.<span class="identifier">size</span>.<span class="identifier">height</span>)]</span>; </span><br><span class="line">	<span class="comment">//设置线条终点形状 </span></span><br><span class="line">	<span class="constructor">CGContextSetLineCap(UIGraphicsGetCurrentContext()</span>, kCGLineCapRound); </span><br><span class="line">	<span class="comment">// 5是每个虚线的长度 1是高度 </span></span><br><span class="line">	<span class="built_in">float</span> lengths<span class="literal">[]</span> = &#123;<span class="number">5</span>,<span class="number">1</span>&#125;; </span><br><span class="line">	CGContextRef line = <span class="constructor">UIGraphicsGetCurrentContext()</span>; </span><br><span class="line">	<span class="comment">// 设置颜色 </span></span><br><span class="line">	<span class="constructor">CGContextSetStrokeColorWithColor(<span class="params">line</span>, [UIColor <span class="params">colorWithWhite</span>:0.408 <span class="params">alpha</span>:1.000].CGColor)</span>; </span><br><span class="line">	<span class="constructor">CGContextSetLineDash(<span class="params">line</span>, 0, <span class="params">lengths</span>, 2)</span>; </span><br><span class="line">	<span class="comment">//画虚线 </span></span><br><span class="line">	<span class="constructor">CGContextMoveToPoint(<span class="params">line</span>, 0.0, 2.0)</span>; </span><br><span class="line">	<span class="comment">//开始画线 CGContextAddLineToPoint(line, kScreenWidth - 10, 2.0); </span></span><br><span class="line">	<span class="constructor">CGContextStrokePath(<span class="params">line</span>)</span>;</span><br><span class="line">	<span class="constructor">UIGraphicsGetImageFromCurrentImageContext()</span></span><br><span class="line">	<span class="comment">//返回的就是image</span></span><br><span class="line">	return <span class="constructor">UIGraphicsGetImageFromCurrentImageContext()</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、通过CAShapeLayer方式绘制虚线"><a href="#三、通过CAShapeLayer方式绘制虚线" class="headerlink" title="三、通过CAShapeLayer方式绘制虚线"></a>三、通过CAShapeLayer方式绘制虚线</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">** lineView: 需要绘制成虚线的view </span></span><br><span class="line"><span class="comment">** lineLength: 虚线的宽度 </span></span><br><span class="line"><span class="comment">** lineSpacing: 虚线的间距 </span></span><br><span class="line"><span class="comment">** lineColor: 虚线的颜色 </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">+ (<span class="keyword">void</span>)drawDashLine:(<span class="built_in">UIView</span> *)lineView lineLength:(<span class="keyword">int</span>)lineLength lineSpacing:(<span class="keyword">int</span>)lineSpacing lineColor:(<span class="built_in">UIColor</span> *)lineColor</span><br><span class="line">&#123; </span><br><span class="line">	<span class="built_in">CAShapeLayer</span> *shapeLayer = [<span class="built_in">CAShapeLayer</span> layer]; </span><br><span class="line">	[shapeLayer setBounds:lineView.bounds]; </span><br><span class="line">	[shapeLayer setPosition:<span class="built_in">CGPointMake</span>(<span class="built_in">CGRectGetWidth</span>(lineView.frame) / <span class="number">2</span>, <span class="built_in">CGRectGetHeight</span>(lineView.frame))];</span><br><span class="line">	[shapeLayer setFillColor:[<span class="built_in">UIColor</span> clearColor].CGColor]; </span><br><span class="line">	<span class="comment">// 设置虚线颜色为blackColor </span></span><br><span class="line">	[shapeLayer setStrokeColor:lineColor.CGColor]; </span><br><span class="line">	<span class="comment">// 设置虚线宽度 </span></span><br><span class="line">	[shapeLayer setLineWidth:<span class="built_in">CGRectGetHeight</span>(lineView.frame)]; </span><br><span class="line">	[shapeLayer setLineJoin:kCALineJoinRound]; </span><br><span class="line">	<span class="comment">// 设置线宽，线间距 </span></span><br><span class="line">	[shapeLayer setLineDashPattern:[<span class="built_in">NSArray</span> arrayWithObjects:[<span class="built_in">NSNumber</span> numberWithInt:lineLength], [<span class="built_in">NSNumber</span> numberWithInt:lineSpacing], <span class="literal">nil</span>]]; </span><br><span class="line">	<span class="comment">// 设置路径 CGMutablePathRef path = CGPathCreateMutable(); CGPathMoveToPoint(path, NULL, 0, 0);</span></span><br><span class="line">	<span class="built_in">CGPathAddLineToPoint</span>(path, <span class="literal">NULL</span>,<span class="built_in">CGRectGetWidth</span>(lineView.frame), <span class="number">0</span>); </span><br><span class="line">	[shapeLayer setPath:path]; <span class="built_in">CGPathRelease</span>(path); </span><br><span class="line">	<span class="comment">// 把绘制好的虚线添加上来 </span></span><br><span class="line">	[lineView.layer addSublayer:shapeLayer]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这部分代码，有一个注意点：就是position和anchorPoint的区别，这点有兴趣的可以去脑补一下。当然layer上的绘图，我也感觉自己很low了，因为形式没用过，所以基本上快忘光了，所以自己也需要花时间去脑补一下。链接：<a href="http://wonderffee.github.io/blog/2013/10/13/understand-anchorpoint-and-position/" target="_blank" rel="noopener">http://wonderffee.github.io/blog/2013/10/13/understand-anchorpoint-and-position/</a></p>
<h2 id="四、图片平铺（简单暴力）"><a href="#四、图片平铺（简单暴力）" class="headerlink" title="四、图片平铺（简单暴力）"></a>四、图片平铺（简单暴力）</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImageView</span> *imgDashLineView =[[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">15</span>, <span class="number">200</span>, <span class="keyword">self</span>.view.frame.size.width - <span class="number">30</span>, <span class="number">1</span>)];</span><br><span class="line">[imgDashLineView setBackgroundColor:[<span class="built_in">UIColor</span> colorWithPatternImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"xuxian.png"</span>]]];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imgDashLineView];</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ericlife.top/iOS%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Eric">
      <meta itemprop="description" content="记录开发过程中技术点">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光书馆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iOS%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0.html" class="post-title-link" itemprop="url">iOS开发常用数学函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-24 10:50:15" itemprop="dateCreated datePublished" datetime="2017-02-24T10:50:15+08:00">2017-02-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-06-13 13:21:05" itemprop="dateModified" datetime="2018-06-13T13:21:05+08:00">2018-06-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>994</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-三角函数"><a href="#1-三角函数" class="headerlink" title="1.  三角函数"></a>1.  三角函数</h3><p>　　double sin (double);正弦<br>　　double cos (double);余弦<br>　　double tan (double);正切 </p>
<h3 id="2-反三角函数"><a href="#2-反三角函数" class="headerlink" title="2.  反三角函数"></a>2.  反三角函数</h3><p>　　double asin (double); 结果介于[-PI/2, PI/2]<br>　　double acos (double); 结果介于[0, PI]<br>　　double atan (double); 反正切(主值), 结果介于[-PI/2, PI/2]<br>　　double atan2 (double, double); 反正切(整圆值), 结果介于[-PI, PI] </p>
<h3 id="3-双曲三角函数"><a href="#3-双曲三角函数" class="headerlink" title="3.  双曲三角函数"></a>3.  双曲三角函数</h3><p>　　double sinh (double);<br>　　double cosh (double);<br>　　double tanh (double); </p>
<h3 id="4-指数与对数"><a href="#4-指数与对数" class="headerlink" title="4. 指数与对数"></a>4. 指数与对数</h3><p>　　double exp (double);求取自然数e的幂<br>　　double sqrt (double);开平方<br>　　double log (double); 以e为底的对数<br>　　double log10 (double);以10为底的对数<br>　　double pow(double x, double y）;计算以x为底数的y次幂<br>　　float powf(float x, float y); 功能与pow一致，只是输入与输出皆为浮点数 </p>
<h3 id="5-取整"><a href="#5-取整" class="headerlink" title="5. 取整"></a>5. 取整</h3><p>　　double ceil (double); 取上整<br>　　double floor (double); 取下整 </p>
<h3 id="6-绝对值"><a href="#6-绝对值" class="headerlink" title="6. 绝对值"></a>6. 绝对值</h3><p>　　double fabs (double);求绝对值<br>　　double cabs(struct complex znum) ;求复数的绝对值 </p>
<h3 id="7-标准化浮点数"><a href="#7-标准化浮点数" class="headerlink" title="7.  标准化浮点数"></a>7.  标准化浮点数</h3><p>　　double frexp (double f, int *p); 标准化浮点数, f = x * 2^p, 已知f求x, p ( x介于[0.5, 1] )<br>　　double ldexp (double x, int p); 与frexp相反, 已知x, p求f </p>
<h3 id="8-取整与取余"><a href="#8-取整与取余" class="headerlink" title="8. 取整与取余"></a>8. 取整与取余</h3><p>　　double modf (double, double*); 将参数的整数部分通过指针回传, 返回小数部分<br>　　double fmod (double, double); 返回两参数相除的余数 </p>
<h3 id="9-其他"><a href="#9-其他" class="headerlink" title="9. 其他"></a>9. 其他</h3><p>　　double hypot(double x, double y);已知直角三角形两个直角边长度，求斜边长度<br>　　double ldexp(double x, int exponent);计算x*(2的exponent次幂)<br>　　double poly(double x, int degree, double coeffs [] );计算多项式<br>　　nt matherr(struct exception *e);数学错误计算处理程序</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Eric</p>
  <div class="site-description" itemprop="description">记录开发过程中技术点</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eric</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">255k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:52</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      element.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script pjax>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>
</body>
</html>
